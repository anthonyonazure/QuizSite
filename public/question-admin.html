<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Administration</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold mb-4">Question Administration</h1>
        
        <div id="question-management">
            <h2 class="text-xl font-semibold mb-2">Questions</h2>
            <table class="w-full bg-white shadow-md rounded mb-4">
                <thead>
                    <tr>
                        <th class="border p-2">ID</th>
                        <th class="border p-2">Statement</th>
                        <th class="border p-2">Answer</th>
                        <th class="border p-2">Actions</th>
                    </tr>
                </thead>
                <tbody id="question-list">
                    <!-- Questions will be populated here -->
                </tbody>
            </table>

            <h2 class="text-xl font-semibold mb-2">Add/Edit Question</h2>
            <form id="question-form" class="bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4">
                <input type="hidden" id="question-id">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="statement">
                        Statement
                    </label>
                    <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="statement" type="text" placeholder="Enter question statement">
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2" for="answer">
                        Answer
                    </label>
                    <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="answer">
                        <option value="true">True</option>
                        <option value="false">False</option>
                    </select>
                </div>
                <div class="flex items-center justify-between">
                    <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" onclick="saveQuestion()">
                        Save Question
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        window.onload = function() {
            loadQuestions();
        }

        async function loadQuestions() {
            try {
                const response = await fetch('/api/admin/questions', {
                    headers: { 'Authorization': getAdminToken() }
                });

                if (response.ok) {
                    const questions = await response.json();
                    const questionList = document.getElementById('question-list');
                    questionList.innerHTML = '';

                    questions.forEach(question => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="border p-2">${question.id}</td>
                            <td class="border p-2">${question.statement}</td>
                            <td class="border p-2">${question.answer}</td>
                            <td class="border p-2">
                                <button onclick="editQuestion(${question.id})" class="bg-yellow-500 text-white px-2 py-1 rounded mr-2">Edit</button>
                                <button onclick="deleteQuestion(${question.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
                            </td>
                        `;
                        questionList.appendChild(row);
                    });
                } else if (response.status === 401) {
                    handleUnauthorized();
                } else {
                    alert('Failed to load questions.');
                }
            } catch (error) {
                console.error('Load questions error:', error);
                alert('An error occurred while loading questions.');
            }
        }

        async function saveQuestion() {
            const id = document.getElementById('question-id').value;
            const statement = document.getElementById('statement').value;
            const answer = document.getElementById('answer').value === 'true';

            const method = id ? 'PUT' : 'POST';
            const url = id ? `/api/admin/questions/${id}` : '/api/admin/questions';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': getAdminToken()
                    },
                    body: JSON.stringify({ statement, answer })
                });

                if (response.ok) {
                    loadQuestions();
                    resetForm();
                } else if (response.status === 401) {
                    handleUnauthorized();
                } else {
                    alert('Failed to save question.');
                }
            } catch (error) {
                console.error('Save question error:', error);
                alert('An error occurred while saving the question.');
            }
        }

        function editQuestion(id) {
            const row = document.querySelector(`#question-list tr td:first-child:contains('${id}')`).parentNode;
            document.getElementById('question-id').value = id;
            document.getElementById('statement').value = row.cells[1].textContent;
            document.getElementById('answer').value = row.cells[2].textContent;
        }

        async function deleteQuestion(id) {
            if (confirm('Are you sure you want to delete this question?')) {
                try {
                    const response = await fetch(`/api/admin/questions/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': getAdminToken() }
                    });

                    if (response.ok) {
                        loadQuestions();
                    } else if (response.status === 401) {
                        handleUnauthorized();
                    } else {
                        alert('Failed to delete question.');
                    }
                } catch (error) {
                    console.error('Delete question error:', error);
                    alert('An error occurred while deleting the question.');
                }
            }
        }

        function resetForm() {
            document.getElementById('question-id').value = '';
            document.getElementById('statement').value = '';
            document.getElementById('answer').value = 'true';
        }

        function getAdminToken() {
            // In a real application, you would securely store and retrieve the token
            // This is a placeholder implementation
            return localStorage.getItem('adminToken');
        }

        function handleUnauthorized() {
            alert('Your session has expired or you are not authorized. Please log in again.');
            window.location.href = '/admin'; // Redirect to admin login page
        }
    </script>
</body>
</html>